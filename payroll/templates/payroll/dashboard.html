{% extends 'index.html' %}
{% block content %}
{% load static i18n %}
{% load i18n %}

<!-- End of Navigation -->
<main :class="sidebarOpen ? 'oh-main__sidebar-visible' : ''">
    <div class="oh-wrapper">
        <div class="oh-dashboard row" id="dashboard">
            <div class="oh-dashboard__left col-12 col-sm-12 col-md-12 col-lg-12">
                <div class="oh-dashboard__cards row">
                    <div class="col-12 col-sm-12 col-md-6 col-lg-3 filter" id="paidPayslip">
                        <div class="oh-card-dashboard oh-card-dashboard oh-card-dashboard--success" style="border-radius: 12px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(40, 167, 69, 0.2)';" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none';" onmousedown="this.style.transform='translateY(-2px) scale(0.98)';" onmouseup="this.style.transform='translateY(-4px) scale(1.02)';">
                            <div class="oh-card-dashboard__header">
                                <span class="oh-card-dashboard__title" style="font-size: 16px; font-weight: 600;">{% trans "Paid" %}</span>
                            </div>
                            <div class="oh-card-dashboard__body">
                                    <span class="oh-card-dashboard__count" style="font-size: 28px; font-weight: bold;">{{paid|length}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-md-6 col-lg-3 filter" id="confirmedPayslip">
                        <div class="oh-card-dashboard oh-card-dashboard--neutral" style="border-radius: 12px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(108, 117, 125, 0.2)';" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none';" onmousedown="this.style.transform='translateY(-2px) scale(0.98)';" onmouseup="this.style.transform='translateY(-4px) scale(1.02)';">
                            <div class="oh-card-dashboard__header">
                                <span class="oh-card-dashboard__title" style="font-size: 16px; font-weight: 600;">{% trans "Confirmed" %}</span>
                            </div>
                            <div class="oh-card-dashboard__body">
                                    <span class="oh-card-dashboard__count" style="font-size: 28px; font-weight: bold;">{{posted|length}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-md-6 col-lg-3 filter" id="reviewPayslip">
                        <div class="oh-card-dashboard oh-card-dashboard--warning" style="border-radius: 12px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(255, 193, 7, 0.2)';" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none';" onmousedown="this.style.transform='translateY(-2px) scale(0.98)';" onmouseup="this.style.transform='translateY(-4px) scale(1.02)';">
                            <div style="text-decoration: none;" class="oh-card-dashboard__header">
                                <span class="oh-card-dashboard__title" style="font-size: 16px; font-weight: 600;">{% trans "Review Ongoing" %}</span>
                            </div>
                            <div class="oh-card-dashboard__body">
                                <a style="text-decoration: none;" class="oh-card-dashboard__counts">
                                    <span class="oh-card-dashboard__count" style="font-size: 28px; font-weight: bold;"> {{review_ongoing|length}} </span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-md-6 col-lg-3 filter" id="draftPayslip">
                        <div class="oh-card-dashboard oh-card-dashboard--danger" style="border-radius: 12px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;" onmouseover="this.style.transform='translateY(-4px) scale(1.02)'; this.style.boxShadow='0 8px 25px rgba(220, 53, 69, 0.2)';" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='none';" onmousedown="this.style.transform='translateY(-2px) scale(0.98)';" onmouseup="this.style.transform='translateY(-4px) scale(1.02)';">
                            <div style="text-decoration: none;" class="oh-card-dashboard__header">
                                <span class="oh-card-dashboard__title" style="font-size: 16px; font-weight: 600;">{% trans "Draft" %}</span>
                            </div>
                            <div class="oh-card-dashboard__body">
                                <a style="text-decoration: none;" class="oh-card-dashboard__counts">
                                    <span class="oh-card-dashboard__count" style="font-size: 28px; font-weight: bold;"> {{draft|length}} </span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="oh-btn-group ms-2 mt-3 justify-content-between">
                    <div style="cursor: pointer; background: #f8f9fa; padding: 20px; border-radius: 16px; border: 2px solid #dee2e6; transition: all 0.3s ease; position: relative;" onmouseover="this.style.borderColor='#6c9bd1'; this.style.background='#ffffff'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#dee2e6'; this.style.background='#f8f9fa'; this.style.transform='translateY(0)';">
                        <label for="monthYearField" class="fw-bold" style="cursor: pointer; font-size: 18px; margin-bottom: 12px; display: block; color: #495057; transition: color 0.3s ease;">{% trans "Select Month and Year" %}</label>
                        <div style="position: relative; display: inline-block; width: 100%;">
                            <input class="oh-select" type="month" id="monthYearField" name="monthYearField" style="cursor: pointer; border: 3px solid #6c9bd1; border-radius: 12px; font-size: 18px; padding: 12px 16px; background: white; width: 100%; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); font-weight: 600; color: #495057;" onfocus="this.style.transform='scale(1.05)'; this.style.borderColor='#5a8bc4'; this.style.boxShadow='0 0 0 4px rgba(108, 155, 209, 0.2)'; this.parentElement.parentElement.style.borderColor='#5a8bc4';" onblur="this.style.transform='scale(1)'; this.style.borderColor='#6c9bd1'; this.style.boxShadow='none'; this.parentElement.parentElement.style.borderColor='#6c9bd1';" onchange="this.style.borderColor='#28a745'; setTimeout(() => { this.style.borderColor='#6c9bd1'; }, 1000);">
                            <div style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); pointer-events: none; color: #6c9bd1; font-size: 20px;">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 14px; color: #6c757d; opacity: 0.8;">Click to select reporting period</div>
                    </div>

                    <div class="oh-main__titlebar-button-container">
                        <div class="oh-dropdown" x-data="{open: false}">
                          <button class="oh-btn oh-btn--secondary oh-btn--shadow ml-2" @click="open = !open" style="background: #6c9bd1; border: none; color: white; padding: 12px 20px; border-radius: 12px; font-weight: 600; transition: all 0.3s ease; font-size: 16px;" onmouseover="this.style.background='#5a8bc4'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(108, 155, 209, 0.3)';" onmouseout="this.style.background='#6c9bd1'; this.style.transform='translateY(0)'; this.style.boxShadow='none';" onmousedown="this.style.transform='translateY(0) scale(0.98)';" onmouseup="this.style.transform='translateY(-2px) scale(1)';">
                            <ion-icon name="download-outline" class="mr-1" style="font-size: 18px;"></ion-icon>{% trans "Export" %}
                          </button>
                          <div
                          class="oh-dropdown__menu oh-dropdown__menu--right oh-dropdown__filter p-4"
                          x-show="open"
                          @click.outside="open = false"
                          style="display: none;"
                          >
                            <form method = "post" action="{% url 'dashboard-export' %}">
                                {% csrf_token %}
                                <div class="row">
                                    <div class="col-sm-12 col-md-12 col-lg-6">
                                        <div class="oh-input-group">
                                            <label class="oh-label d-block">{% trans "Start Date" %}</label>
                                            {{export_form.start_date}}
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-12 col-lg-6">
                                        <div class="oh-input-group" >
                                            <label class="oh-label d-block">{% trans "End Date" %}</label>
                                            {{export_form.end_date}}
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-12 col-lg-6 ">
                                        <div class="oh-input-group">
                                        <label class="oh-label">{% trans "Employee" %}</label>
                                            {{export_form.employees}}
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-12 col-lg-6 ">
                                        <div class="oh-input-group">
                                            <label class="oh-label d-block">{% trans "Status" %}</label>
                                            {{export_form.status}}
                                        </div>
                                    </div>
                                    <div class="col-sm-12 col-md-12 col-lg-12 mb-3">
                                        <div class="oh-input-group">
                                            <label class="oh-label d-block">{% trans "Contributions" %}</label>
                                            {{export_form.contributions}}
                                        </div>
                                    </div>
                                    <div class="d-flex flex-row-reverse" >
                                        <button
                                        class="oh-btn oh-btn--secondary oh-btn--shadow" type="submit" id="export" style="background: #28a745; border: none; color: white; padding: 10px 18px; border-radius: 10px; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#218838'; this.style.transform='translateY(-1px)';" onmouseout="this.style.background='#28a745'; this.style.transform='translateY(0)';" onmousedown="this.style.transform='translateY(0) scale(0.98)';" onmouseup="this.style.transform='translateY(-1px) scale(1)';"
                                        >
                                            <ion-icon
                                                class="me-2 md hydrated"
                                                name="download-outline"
                                                role="img"
                                                aria-label="download-outline"
                                                style="font-size: 16px;"
                                            ></ion-icon
                                            >{% trans "Export" %}</button
                                        >
                                    </div>
                                </div>
                            </form>
                          </div>
                        </div>
                    </div>
                </div>

                <div class="oh-dashboard__movable-cards row mt-4">
                    <div class="col-12 col-sm-12 col-md-12 col-lg-6 mb-4">
                        <div class="oh-card-dashboard oh-card-dashboard--no-scale oh-card-dashboard--transparent" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px;">
                            <div class="oh-card-dashboard__header oh-card-dashboard__header--divider" style="cursor: default; background: #6c9bd1; color: white; padding: 16px; border-radius: 12px 12px 0 0; margin: -1px -1px 0 -1px;">
                                <span class="oh-card-dashboard__title" id="employee-previous" style="cursor: pointer; color: white; padding: 8px 12px; border-radius: 8px; transition: all 0.3s ease; display: inline-flex; align-items: center;" onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(-2px)';" onmouseout="this.style.background='transparent'; this.style.transform='translateX(0)';" onmousedown="this.style.transform='translateX(-2px) scale(0.95)';" onmouseup="this.style.transform='translateX(-2px) scale(1)';"><ion-icon name="caret-back-outline" style="font-size: 20px;"></ion-icon></span>
                                <span class="oh-card-dashboard__title" style="font-size: 18px; color: white; font-weight: bold;">{% trans "Employee Payslips" %}</span>
                                <span class="oh-card-dashboard__title float-end" id="payroll-employee-next" style="cursor: pointer; color: white; padding: 8px 12px; border-radius: 8px; transition: all 0.3s ease; display: inline-flex; align-items: center;" onmouseover="this.style.background='rgba(255,255,255,0.2)'; this.style.transform='translateX(2px)';" onmouseout="this.style.background='transparent'; this.style.transform='translateX(0)';" onmousedown="this.style.transform='translateX(2px) scale(0.95)';" onmouseup="this.style.transform='translateX(2px) scale(1)';"><ion-icon name="caret-forward" style="font-size: 20px;"></ion-icon></span>
                            </div>
                            <div class="oh-card-dashboard__body" id="employee_canvas_body" style="padding: 20px;">
                                <canvas id="employeeChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-md-12 col-lg-6" >
                        <div class="oh-card-dashboard oh-card-dashboard--no-scale oh-card-dashboard--transparent" style="cursor: default; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px;">
                            <div style="background: #6c9bd1; color: white; padding: 16px; border-radius: 12px 12px 0 0; margin: -1px -1px 0 -1px;">
                                <h4 class="m-0 fw-bold" style="font-size: 18px; color: white;">{% trans "Payroll Summary" %}</h4>
                            </div>
                            <div style="padding: 20px;">
                                <h6 class="fw-bold mb-2" style="font-size: 16px; color: #495057;">{% trans "Total Payslips Genarated :" %}  <span class="payslip-number" style="color: #6c9bd1; font-weight: 600;"></span></h6>
                                {% if position == "prefix" %}
                                    <h6 class="fw-bold mb-3" style="font-size: 16px; color: #495057;">{% trans "Total Amount :" %} <span style="color: #7fb069; font-weight: 600;">{{currency}} <span class="payslip-amount"></span></span></h6>
                                {% else %}
                                    <h6 class="fw-bold mb-3" style="font-size: 16px; color: #495057;">{% trans "Total Amount :" %} <span style="color: #7fb069; font-weight: 600;"><span class="payslip-amount"></span> {{currency}}</span></h6>
                                {% endif %}
                                <div style="background: #8e9aaf; color: white; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
                                    <h5 class="m-0 fw-bold" style="font-size: 16px; color: white;">{% trans "Department Total Amount" %}</h5>
                                </div>
                                <ul id="department_total" style="height: 200px; overflow-y: auto; list-style: none; padding: 0; margin: 0;"></ul>
                                <ul id="department_total_empty" style="height: 200px; overflow-y: auto; list-style: none; padding: 0; margin: 0;"></ul>
                            </div>
                        </div>
                    </div>

                    <div class="col-12 col-sm-12 col-md-12 col-lg-6 mb-4">
                        <form hx-get="{% url 'get-contribution-report' %}" hx-trigger="load, submit"  hx-target="#contributionReportContainer" class="oh-card-dashboard oh-card-dashboard--no-scale oh-card-dashboard--transparent" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px;" >
                            <div class="d-flex justify-content-between oh-card-dashboard__header oh-card-dashboard__header--divider" style="cursor: default; background: #7fb069; color: white; padding: 16px; border-radius: 12px 12px 0 0; margin: -1px -1px 0 -1px;">
                                <span class="oh-card-dashboard__title" style="font-size: 18px; color: white; font-weight: bold;">{% trans "Employer Contributions" %}</span>
                                <div>
                                    <span class="oh-card-dashboard__title">
                                        <select name="employee_id" class="oh-select" onchange="$(this).closest('form').find('[type=submit]').click()" id="deduction" style="background: white; border: 1px solid #ced4da; border-radius: 6px; padding: 4px 8px;">
                                            {% for employee in get_active_employees %}
                                                {% if request.user == employee.employee_user_id %}
                                                    <option value="{{employee.id}}" selected>{{employee.get_full_name}}</option>
                                                {% else %}
                                                    <option value="{{employee.id}}">{{employee.get_full_name}}</option>
                                                {% endif %}
                                            {% endfor %}
                                        </select>
                                    </span>
                                </div>
                            </div>
                            <div class="oh-card-dashboard__body" id="contributionReportContainer" style="padding: 20px;">
                            </div>
                            <button type="submit" hidden>
                        </form>
                    </div>
                    <div class="col-12 col-sm-12 col-md-12 col-lg-6">
                        <div class="oh-card-dashboard oh-card-dashboard--no-scale oh-card-dashboard--transparent" style="cursor: default; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px;">
                            <div style="background: #7fb069; color: white; padding: 16px; border-radius: 12px 12px 0 0; margin: -1px -1px 0 -1px;">
                                <h4 class="m-0 fw-bold" style="font-size: 18px; color: white;">{% trans "Employees Joined" %}</h4>
                            </div>
                            <div style="padding: 20px;">
                                <h6 class="fw-bold mb-3" style="font-size: 16px; color: #495057; margin: 0;"><span class="joined-full-text" style="color: #495057;">Number of employees joined in December of 2025 : 0</span></h6>
                                <hr style="border-color: #dee2e6; margin: 16px 0;">
                                <ul id="employees_joined" style="height: 180px; overflow-y: auto; list-style: none; padding: 0; margin: 0;">
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-md-12 col-lg-6">
                        <div class="oh-card-dashboard oh-card-dashboard--no-scale oh-card-dashboard--transparent" style="cursor: default; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px;">
                            <div style="background: #c85450; color: white; padding: 16px; border-radius: 12px 12px 0 0; margin: -1px -1px 0 -1px;">
                                <h4 class="m-0 fw-bold" style="font-size: 18px; color: white;">{% trans "Contracts Ending" %}</h4>
                            </div>
                            <div style="padding: 20px;">
                                <h6 class="fw-bold mb-3" style="font-size: 16px; color: #495057; margin: 0;"><span class="contract-text">{% trans "Number of contracts expiring in " %}</span><span class="contract-number" style="color: #c85450; font-weight: 600;"></span></h6>
                                <hr style="border-color: #dee2e6; margin: 16px 0;">
                                <ul id="contract_ending" style="height: 180px; overflow-y: auto; list-style: none; padding: 0; margin: 0;">
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-sm-12 col-md-12 col-lg-6">
                        <div class="oh-card-dashboard oh-card-dashboard--no-scale oh-card-dashboard--transparent" style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px;">
                            <div class="oh-card-dashboard__header oh-card-dashboard__header--divider" style="background: #c8a2c8; color: white; padding: 16px; border-radius: 12px 12px 0 0; margin: -1px -1px 0 -1px;">
                                <span class="oh-card-dashboard__title" style="font-size: 18px; color: white; font-weight: bold;">{% trans "Department Chart" %}</span>
                            </div>
                            <div class="oh-card-dashboard__body" id="department_canvas_body" style="width: 50%; margin: 0 auto; padding: 20px;" >
                                <canvas id="departmentChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="oh-modal" id="ContractModal" role="dialog" aria-labelledby="ContractModal" aria-hidden="true">
        <div class="oh-modal__dialog" style="max-width: 550px" id="contract_target"></div>
    </div>
</main>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'payroll/dashboard.js' %}?v=2"></script>
<script>
    $(document).ready(function() {
        $("#paidPayslip").on("click", function(){
            window.location.href='{% url "view-payslip" %}?status=paid'
        })
        $("#confirmedPayslip").on("click", function(){
            window.location.href='{% url "view-payslip" %}?status=confirmed'
        })
        $("#reviewPayslip").on("click", function(){
            window.location.href='{% url "view-payslip" %}?status=review_ongoing'
        })
        $("#draftPayslip").on("click", function(){
            window.location.href='{% url "view-payslip" %}?status=draft'
        })
    })

</script>
{% endblock content %}
